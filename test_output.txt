Test Execution Report
====================
Command: pytest tests/test_backends.py -v
Date: Mon Dec  8 05:36:33 CET 2025
Working Directory: /lustre/fast/fast/txiao/ym/rl_onoff

Output:
-------
============================= test session starts ==============================
platform linux -- Python 3.10.19, pytest-9.0.2, pluggy-1.6.0 -- /fast/txiao/conda_envs/rlon/bin/python3.10
cachedir: .pytest_cache
rootdir: /lustre/fast/fast/txiao/ym/rl_onoff
plugins: anyio-4.4.0, typeguard-4.3.0, cov-7.0.0
collecting ... collected 15 items

tests/test_backends.py::TestBackendsSamplingAndMetrics::test_backend_generate_single PASSED [  6%]
tests/test_backends.py::TestBackendsSamplingAndMetrics::test_backend_generate_batch PASSED [ 13%]
tests/test_backends.py::TestBackendsSamplingAndMetrics::test_backend_with_sampler PASSED [ 20%]
tests/test_backends.py::TestBackendsSamplingAndMetrics::test_backend_with_metrics PASSED [ 26%]
tests/test_backends.py::TestBackendsDistributionExtraction::test_backend_get_logits PASSED [ 33%]
tests/test_backends.py::TestBackendsDistributionExtraction::test_backend_get_probabilities PASSED [ 40%]
tests/test_backends.py::TestBackendsDistributionExtraction::test_backend_with_distribution_extractor PASSED [ 46%]
tests/test_backends.py::TestBackendsDivergenceCalculation::test_backend_get_distributions_for_divergence PASSED [ 53%]
tests/test_backends.py::TestBackendsDivergenceCalculation::test_backend_encode_decode PASSED [ 60%]
tests/test_backends.py::TestBackendsModelSwitching::test_backend_with_model_switcher PASSED [ 66%]
tests/test_backends.py::TestBackendsModelSwitching::test_backend_get_probabilities_for_switching PASSED [ 73%]
tests/test_backends.py::TestBackendsBase::test_base_backend_is_loaded PASSED [ 80%]
tests/test_backends.py::TestBackendsBase::test_base_backend_repr PASSED  [ 86%]
tests/test_backends.py::TestBackendsBase::test_get_backend_function FAILED [ 93%]
tests/test_backends.py::TestBackendsIntegration::test_all_purposes_integration PASSED [100%]

=================================== FAILURES ===================================
__________________ TestBackendsBase.test_get_backend_function __________________

self = <tests.test_backends.TestBackendsBase object at 0x1535e61e1c00>

    def test_get_backend_function(self):
        """Test get_backend factory function."""
        with patch('rl_onoff.backends.huggingface.HuggingFaceBackend') as mock_hf:
            backend = get_backend("huggingface", model_name="test")
>           mock_hf.assert_called_once()

tests/test_backends.py:232: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <MagicMock name='HuggingFaceBackend' id='23321238183824'>

    def assert_called_once(self):
        """assert that the mock was called only once.
        """
        if not self.call_count == 1:
            msg = ("Expected '%s' to have been called once. Called %s times.%s"
                   % (self._mock_name or 'mock',
                      self.call_count,
                      self._calls_repr()))
>           raise AssertionError(msg)
E           AssertionError: Expected 'HuggingFaceBackend' to have been called once. Called 0 times.

/fast/txiao/conda_envs/rlon/lib/python3.10/unittest/mock.py:908: AssertionError
=========================== short test summary info ============================
FAILED tests/test_backends.py::TestBackendsBase::test_get_backend_function - ...
======================== 1 failed, 14 passed in 19.42s =========================
